webpackJsonp([7],{"/+Ba":function(t,e){},"/xVW":function(t,e){},EaCm:function(t,e,n){"use strict";n.d(e,"b",function(){return a}),e.a={tabMap:{all:"全部",ask:"问答",good:"精华",job:"招聘",share:"分享",dev:"客户端测试"}};var a={LOGIN:"LOGIN",LOGOUT:"LOGOUT",SHOWLOGINDIALOG:"SHOWLOGINDIALOG",CLOSELOGINDIALOG:"CLOSELOGINDIALOG"}},NHnr:function(t,e,n){"use strict";function a(t){n("ZPFP")}function o(t){n("/xVW")}function s(t){n("s8ub")}function r(t){n("pFc2")}Object.defineProperty(e,"__esModule",{value:!0});var c=n("qRXP"),i=(n("/+Ba"),n("llnD"),n("lC5x")),u=n.n(i),l=n("J0Oq"),p=n.n(l),f=n("w7XY"),d=n("EaCm"),m={name:"base-login",data:function(){return{}},methods:{submit:function(){var t=this;return p()(u.a.mark(function e(){var n;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$refs.accessToken.value,e.prev=1,e.next=4,t.$store.dispatch("login",n);case 4:if(e.t0=e.sent,!e.t0){e.next=7;break}t.close();case 7:e.next=12;break;case 9:e.prev=9,e.t1=e.catch(1),console.log("login fail");case 12:case"end":return e.stop()}},e,t,[[1,9]])}))()},close:function(){this.$refs.accessToken.value="",this.$store.commit(d.b.CLOSELOGINDIALOG)}}},g=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{name:"custom-classes-transition","enter-active-class":"animated bounceInRight","leave-active-class":"animated bounceOutRight"}},[this.$store.state.showLoginDialog?n("div",{staticClass:"modal",staticStyle:{background:"rgba(0,0,0,0.5)",display:"block"},attrs:{id:"myModal",tabindex:"-1"}},[n("div",{staticClass:"modal-dialog",staticStyle:{top:"70px"}},[n("div",{staticClass:"modal-content"},[n("div",{staticClass:"modal-header"},[n("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-hidden":"true"},on:{click:t.close}},[t._v("×\n        ")]),t._v(" "),n("h4",{staticClass:"modal-title",attrs:{id:"myModalLabel"}},[t._v("\n          请输入accessToken ")])]),t._v(" "),n("div",{staticClass:"modal-body"},[n("div",{staticClass:"alert alert-warning",attrs:{role:"alert"}},[t._v("如何获取 accessToken？ 用户登录后，在设置页面可以看到自己的 accessToken。")]),t._v(" "),n("input",{ref:"accessToken",staticClass:"form-control",attrs:{placeholder:"请输入accessToken"}})]),t._v(" "),n("div",{staticClass:"modal-footer"},[n("button",{staticClass:"btn btn-default",attrs:{type:"button","data-dismiss":"modal"},on:{click:t.close}},[t._v("\n          关闭\n        ")]),t._v(" "),n("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:t.submit}},[t._v("\n          确定\n        ")])])])])]):t._e()])},v=[],h={render:g,staticRenderFns:v},b=h,k=n("/Xao"),L=a,I=k(m,b,!1,L,null,null),O=I.exports,_={name:"base-top",components:{BaseLogin:O},data:function(){return{showLogin:!1,msgCount:0}},computed:{isLogin:function(){return this.$store.state.isLogin},userInfo:function(){return this.$store.state.userInfo},accesstoken:function(){return this.$store.state.accesstoken}},methods:{showLoginDialog:function(){this.$store.commit(d.b.SHOWLOGINDIALOG)},logout:function(){this.$store.commit(d.b.LOGOUT)}},mounted:function(){var t=this;return p()(u.a.mark(function e(){var n;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.accesstoken&&(n=f.a.getMessageCount(t.accesstoken),t.msgCount=n.data.data);case 1:case"end":return e.stop()}},e,t)}))()}},C=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("header",{staticClass:"navbar header"},[n("div",{staticClass:"navbar-inner"},[n("div",{staticClass:"container"},[t._m(0,!1,!1),t._v(" "),n("div",{staticClass:"right-links"},[t.isLogin?t._e():n("a",{attrs:{href:"javascript:"},on:{click:t.showLoginDialog}},[t._v("登录")]),t._v(" "),t.isLogin?n("span",[n("router-link",{attrs:{to:{name:"UserIndex",params:{loginname:t.userInfo.loginname}}}},[t._v(t._s(t.userInfo.loginname))]),t._v(" ( "+t._s(t.msgCount)+" )   |  \n          "),n("a",{attrs:{href:"javascript:"},on:{click:t.logout}},[t._v("退出")])],1):t._e()])])]),t._v(" "),n("base-login")],1)},T=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"brand pull-left"},[n("a",{attrs:{href:"#/"}})])}],w={render:C,staticRenderFns:T},G=w,y=n("/Xao"),D=o,S=y(_,G,!1,D,null,null),x=S.exports,A=n("VoG5"),N=n.n(A);c.a.filter("toLocale",function(t){if(!t)return"";var e=new Date(t);return[[e.getFullYear(),e.getMonth()+1,e.getDate()].join("-"),[e.getHours(),e.getMinutes(),e.getSeconds()].join(":")].join(" ")});var $,E=n("a3Yh"),P=n.n(E),j=n("3cXf"),F=n.n(j),H=n("9rMa"),M={getToken:function(){return localStorage.getItem("accessToken")||""},getUserInfo:function(){var t=localStorage.getItem("userInfo")||"";try{return JSON.parse(t)}catch(t){return{}}}};c.a.use(H.a);var R=new H.a.Store({state:{isLogin:!!M.getToken(),accessToken:M.getToken(),userInfo:M.getUserInfo(),showLoginDialog:!1},mutations:($={},P()($,d.b.LOGIN,function(t,e){t.isLogin=!0,t.accessToken=e.accessToken,t.userInfo=e.userInfo,localStorage.setItem("accessToken",e.accessToken),localStorage.setItem("userInfo",F()(e.userInfo))}),P()($,d.b.LOGOUT,function(t){t.isLogin=!1,t.accessToken="",t.userInfo=null,localStorage.removeItem("accessToken"),localStorage.removeItem("userInfo")}),P()($,d.b.SHOWLOGINDIALOG,function(t){t.showLoginDialog=!0}),P()($,d.b.CLOSELOGINDIALOG,function(t){t.showLoginDialog=!1}),$),actions:{login:function(t,e){var n=this;return p()(u.a.mark(function a(){var o;return u.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,f.a.validateAccesstoken(e);case 3:return o=n.sent,console.log("validateAccesstoken",o),t.commit(d.b.LOGIN,{accessToken:e,userInfo:o.data}),n.abrupt("return",o);case 9:n.prev=9,n.t0=n.catch(0),c.a.toasted.error("无效的accessToken");case 12:case"end":return n.stop()}},a,n,[[0,9]])}))()}}}),U=R,X={name:"base-bottom",data:function(){return{topic:{}}}},W=function(){var t=this,e=t.$createElement;return(t._self._c||e)("footer",{staticClass:"footer"})},B=[],q={render:W,staticRenderFns:B},Y=q,J=n("/Xao"),V=s,Z=J(X,Y,!1,V,null,null),z=Z.exports;c.a.use(N.a,{singleton:!0,position:"top-center",duration:3e3,iconPack:"material"}),c.a.toasted.register("loading","Loading...",{icon:"hourglass_empty",duration:null});var K={name:"app",components:{BaseBottom:z,BaseTop:x},store:U},Q=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",[n("base-top"),t._v(" "),n("transition",{attrs:{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated zoomOut",mode:"out-in"}},[n("router-view")],1),t._v(" "),n("base-bottom")],1)},tt=[],et={render:Q,staticRenderFns:tt},nt=et,at=n("/Xao"),ot=r,st=at(K,nt,!1,ot,null,null),rt=st.exports,ct=n("zO6J"),it=function(){return Promise.all([n.e(0),n.e(1)]).then(n.bind(null,"EAr1"))},ut=function(){return Promise.all([n.e(0),n.e(3)]).then(n.bind(null,"EHkK"))},lt=function(){return n.e(5).then(n.bind(null,"3GWb"))},pt=function(){return Promise.all([n.e(0),n.e(2)]).then(n.bind(null,"CZHw"))},ft=function(){return Promise.all([n.e(0),n.e(4)]).then(n.bind(null,"Ye+u"))};c.a.use(ct.a);var dt=new ct.a({routes:[{path:"/",redirect:{path:"/topics"}},{path:"/topics",redirect:{path:"/topics/all",query:{page:1}}},{path:"/topics/:tab",name:"Topics",component:it},{path:"/topic/:id",name:"TopicDetail",component:ut},{path:"/user/:loginname",component:lt,children:[{path:"",name:"UserIndex",component:pt},{path:"collections",name:"Collections",component:ft}]}]});c.a.config.productionTip=!1,new c.a({el:"#app",router:dt,template:"<App/>",components:{App:rt}})},ZPFP:function(t,e){},llnD:function(t,e){},pFc2:function(t,e){},s8ub:function(t,e){},w7XY:function(t,e,n){"use strict";var a=n("rVsN"),o=n.n(a),s=n("2sCs"),r=n.n(s),c=n("qRXP"),i=void 0;r.a.interceptors.request.use(function(t){return i=c.a.toasted.global.loading(),t},function(t){return i.goAway(300),o.a.reject(t)}),r.a.interceptors.response.use(function(t){return i.goAway(300),t},function(t){return i.goAway(300),o.a.reject(t)});var u="https://cnodejs.org/api/v1";e.a={getTopics:function(t){return r.a.get(u+"/topics",{params:t})},getTopic:function(t,e){return r.a.get(u+"/topic/"+t,{params:{accesstoken:e}})},getUser:function(t){return r.a.get(u+"/user/"+t)},postTopics:function(t){return r.a.post(u+"/topics/",{params:t})},updateTopics:function(t){return r.a.post(u+"/topics/update",{params:t})},validateAccesstoken:function(t){return r.a.post(u+"/accesstoken",{accesstoken:t})},collect:function(t){return r.a.post(u+"/topic_collect/collect",t)},unCollect:function(t){return r.a.post(u+"/topic_collect/de_collect",t)},getCollect:function(t){return r.a.get(u+"/topic_collect/"+t)},getMessageCount:function(t){return r.a.get(u+"/message/count",{params:{accesstoken:t}})},upReply:function(t,e){return r.a.post(u+"/reply/"+t+"/ups",{accesstoken:e})}}}},["NHnr"]);
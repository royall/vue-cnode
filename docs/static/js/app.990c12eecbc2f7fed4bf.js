webpackJsonp([1],{"/+Ba":function(t,e){},"1u5l":function(t,e){},"63Oz":function(t,e){},G4UL:function(t,e){},NHnr:function(t,e,a){"use strict";function n(t){a("zAQO")}function s(t){a("Uxwe")}function o(t){a("QziA")}function i(t){a("63Oz")}function c(t){a("zHgc")}function r(t){a("1u5l")}function l(t){a("gu5E")}function u(t){a("G4UL")}function p(t){a("PSBo")}Object.defineProperty(e,"__esModule",{value:!0});var d=a("qRXP"),g=(a("/+Ba"),a("rVsN")),v=a.n(g),f=a("2sCs"),h=a.n(f),m=void 0;h.a.interceptors.request.use(function(t){return m=d.a.toasted.global.loading(),t},function(t){return m.goAway(300),v.a.reject(t)}),h.a.interceptors.response.use(function(t){return m.goAway(300),t},function(t){return m.goAway(300),v.a.reject(t)});var _="https://cnodejs.org/api/v1",b={getTopics:function(t){return h.a.get(_+"/topics",{params:t})},getTopic:function(t,e){return h.a.get(_+"/topic/"+t,{params:{accesstoken:e}})},getUser:function(t){return h.a.get(_+"/user/"+t)},postTopics:function(t){return h.a.post(_+"/topics/",{params:t})},updateTopics:function(t){return h.a.post(_+"/topics/update",{params:t})},validateAccesstoken:function(t){return h.a.post(_+"/accesstoken",{accesstoken:t})},collect:function(t){return h.a.post(_+"/topic_collect/collect",t)},unCollect:function(t){return h.a.post(_+"/topic_collect/de_collect",t)},getCollect:function(t){return h.a.get(_+"/topic_collect/"+t)},getMessageCount:function(t){return h.a.get(_+"/message/count",{params:{accesstoken:t}})},upReply:function(t,e){return h.a.post(_+"/reply/"+t+"/ups",{accesstoken:e})}},C={name:"Login",data:function(){return{}},methods:{submit:function(){var t=this,e=this.$refs.accessToken.value;this.$store.dispatch("login",e).then(function(){t.close()}).catch(function(){console.log("login fail")})},close:function(){this.$refs.accessToken.value="",this.$store.commit("closeLoginDialog")}}},k=function(){var t=this,e=t.$createElement,a=t._self._c||e;return this.$store.state.showLoginDialog?a("div",{staticClass:"modal fade",staticStyle:{background:"rgba(0,0,0,0.5)",opacity:"1",display:"block"},attrs:{id:"myModal",tabindex:"-1",role:"dialog","aria-labelledby":"myModalLabel","aria-hidden":"true"}},[a("div",{staticClass:"modal-dialog",staticStyle:{top:"70px"}},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-hidden":"true"},on:{click:t.close}},[t._v("×\n        ")]),t._v(" "),a("h4",{staticClass:"modal-title",attrs:{id:"myModalLabel"}},[t._v("\n          请输入accessToken ")])]),t._v(" "),a("div",{staticClass:"modal-body"},[a("div",{staticClass:"alert alert-warning",attrs:{role:"alert"}},[t._v("如何获取 accessToken？ 用户登录后，在设置页面可以看到自己的 accessToken。")]),t._v(" "),a("input",{ref:"accessToken",staticClass:"form-control",attrs:{placeholder:"请输入accessToken"}})]),t._v(" "),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"btn btn-default",attrs:{type:"button","data-dismiss":"modal"},on:{click:t.close}},[t._v("\n          关闭\n        ")]),t._v(" "),a("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:t.submit}},[t._v("\n          确定\n        ")])])])])]):t._e()},T=[],y={render:k,staticRenderFns:T},$=y,L=a("/Xao"),x=L(C,$,!1,null,null,null),I=x.exports,w={getToken:function(){return localStorage.getItem("accessToken")||""},getUserInfo:function(){var t=localStorage.getItem("userInfo")||"";try{return JSON.parse(t)}catch(t){return{}}}},U={name:"Top",components:{Login:I},data:function(){return{showLogin:!1,msgCount:0}},computed:{isLogin:function(){return this.$store.state.isLogin},userInfo:function(){return this.$store.state.userInfo},accesstoken:function(){return this.$store.state.accesstoken}},methods:{showLoginDialog:function(){this.$store.commit("showLoginDialog")},logout:function(){this.$store.commit("logout")}},mounted:function(){var t=this;this.accesstoken&&b.getMessageCount(this.accesstoken).then(function(e){t.msgCount=e.data.data})}},D=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("header",{staticClass:"navbar header"},[a("div",{staticClass:"navbar-inner"},[a("div",{staticClass:"container"},[t._m(0,!1,!1),t._v(" "),a("div",{staticClass:"right-links"},[t.isLogin?t._e():a("a",{attrs:{href:"javascript:;"},on:{click:t.showLoginDialog}},[t._v("登录")]),t._v(" "),t.isLogin?a("span",[a("router-link",{attrs:{to:{name:"UserIndex",params:{loginname:t.userInfo.loginname}}}},[t._v(t._s(t.userInfo.loginname))]),t._v(" ( "+t._s(t.msgCount)+" )   |  \n          "),a("a",{attrs:{href:"javascript:;"},on:{click:t.logout}},[t._v("退出")])],1):t._e()])])]),t._v(" "),a("Login")],1)},E=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"brand pull-left"},[a("a",{attrs:{href:"#/"}},[t._v("vue-CNode")])])}],R={render:D,staticRenderFns:E},S=R,M=a("/Xao"),P=n,N=M(U,S,!1,P,null,null),X=N.exports,F={name:"Bottom",data:function(){return{topic:{}}}},A=function(){var t=this,e=t.$createElement;return(t._self._c||e)("footer",{staticClass:"footer"})},j=[],q={render:A,staticRenderFns:j},O=q,z=a("/Xao"),B=s,H=z(F,O,!1,B,null,null),V=H.exports,Q=a("IZMb"),J=a.n(Q);d.a.filter("toLocale",function(t){if(!t)return"";var e=new Date(t);return[[e.getFullYear(),e.getMonth()+1,e.getDate()].join("-"),[e.getHours(),e.getMinutes(),e.getSeconds()].join(":")].join(" ")});var G=a("3cXf"),Y=a.n(G),Z=a("NYxO");d.a.use(Z.a);var K=new Z.a.Store({state:{isLogin:!!w.getToken(),accessToken:w.getToken(),userInfo:w.getUserInfo(),showLoginDialog:!1},mutations:{login:function(t,e){t.isLogin=!0,t.accessToken=e.accessToken,t.userInfo=e.userInfo,localStorage.setItem("accessToken",e.accessToken),localStorage.setItem("userInfo",Y()(e.userInfo))},logout:function(t){t.isLogin=!1,t.accessToken="",t.userInfo=null,localStorage.removeItem("accessToken"),localStorage.removeItem("userInfo")},showLoginDialog:function(t){t.showLoginDialog=!0},closeLoginDialog:function(t){t.showLoginDialog=!1}},actions:{login:function(t,e){return new v.a(function(a,n){b.validateAccesstoken(e).then(function(n){console.log("validateAccesstoken",n),t.commit("login",{accessToken:e,userInfo:n.data}),a()}).catch(function(){d.a.toasted.error("无效的accessToken"),n()})})}}}),W=K;d.a.use(J.a,{singleton:!0,position:"top-center",duration:3e3,iconPack:"material"}),d.a.toasted.register("loading","Loading...",{icon:"hourglass_empty",duration:null});var tt={name:"app",components:{Top:X,Bottom:V},store:W},et=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",[a("Top"),t._v(" "),a("router-view"),t._v(" "),a("Bottom")],1)},at=[],nt={render:et,staticRenderFns:at},st=nt,ot=a("/Xao"),it=o,ct=ot(tt,st,!1,it,null,null),rt=ct.exports,lt=a("zO6J"),ut={tabMap:{all:"全部",ask:"问答",good:"精华",job:"招聘",share:"分享",dev:"客户端测试"}},pt={name:"TopicList",props:{topics:Array},methods:{getTabDesc:function(t){return t.top?"置顶":t.good?"精华":ut.tabMap[t.tab]},getClassName:function(t){return t.top||t.good?"label-success":"label-default"}}},dt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",{staticClass:"list-group"},t._l(t.topics,function(e){return a("li",{staticClass:"list-group-item",attrs:{"data-id":e.id}},[a("router-link",{attrs:{to:{name:"UserIndex",params:{loginname:e.author.loginname}}}},[a("img",{staticClass:"avatar",attrs:{src:e.author.avatar_url}})]),t._v(" "),a("span",{staticClass:"label",class:t.getClassName(e)},[t._v(t._s(t.getTabDesc(e)))]),t._v(" "),a("router-link",{attrs:{to:{name:"TopicDetail",params:{id:e.id}}}},[t._v(t._s(e.title))]),t._v(" "),e.visit_count?a("span",{staticClass:"badge"},[a("span",{attrs:{title:"回复数"}},[t._v(t._s(e.reply_count))]),t._v("/"),a("span",{attrs:{title:"点击数"}},[t._v(t._s(e.visit_count))])]):t._e()],1)}))},gt=[],vt={render:dt,staticRenderFns:gt},ft=vt,ht=a("/Xao"),mt=i,_t=ht(pt,ft,!1,mt,null,null),bt=_t.exports,Ct={name:"Pager",props:{page:Number,tab:String,name:String},computed:{pageObj:function(){for(var t=this.startPage,e=this.endPage,a=[],n=t;n<=e;n++)a.push({page:n});return a},startPage:function(){return this.page>3?this.page-2:1},endPage:function(){return this.page>3?this.page+2:5}}},kt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("nav",{attrs:{"aria-label":"Page navigation"}},[a("ul",{staticClass:"pagination"},[a("li",[a("router-link",{attrs:{to:{name:t.name,params:{tab:t.tab},query:{page:t.page-1<=1?1:t.page-1}},"aria-label":"Previous"}},[a("span",{attrs:{"aria-hidden":"true"}},[t._v("«")])])],1),t._v(" "),t._l(t.pageObj,function(e){return a("router-link",{key:e.page,attrs:{"exact-active-class":"active",tag:"li",to:{name:t.name,params:{tab:t.tab},query:{page:e.page}}}},[a("a",[t._v(t._s(e.page))])])}),t._v(" "),a("li",[a("router-link",{attrs:{to:{name:t.name,params:{tab:t.tab},query:{page:t.page+1}},"aria-label":"Next"}},[a("span",{attrs:{"aria-hidden":"true"}},[t._v("»")])])],1)],2)])},Tt=[],yt={render:kt,staticRenderFns:Tt},$t=yt,Lt=a("/Xao"),xt=c,It=Lt(Ct,$t,!1,xt,null,null),wt=It.exports,Ut={name:"tab-nav",data:function(){return{tabs:ut.tabMap}}},Dt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",{staticClass:"nav nav-pills"},t._l(t.tabs,function(e,n){return a("router-link",{key:n,attrs:{role:"presentation",tag:"li",to:{name:"Topics",params:{tab:n},query:{page:1}},"active-class":"active"}},[a("a",[t._v(t._s(e))])])}))},Et=[],Rt={render:Dt,staticRenderFns:Et},St=Rt,Mt=a("/Xao"),Pt=Mt(Ut,St,!1,null,null,null),Nt=Pt.exports,Xt={name:"v-title",created:function(){this.updateTitle()},beforeUpdate:function(){this.updateTitle()},methods:{updateTitle:function(){var t=this.$slots.default;if(!(void 0===t||t.length<1||"string"!=typeof t[0].text)){var e=t[0].text;e!==document.title&&(document.title=e)}}}},Ft=function(){var t=this,e=t.$createElement;t._self._c;return t._e()},At=[],jt={render:Ft,staticRenderFns:At},qt=jt,Ot=a("/Xao"),zt=Ot(Xt,qt,!1,null,null,null),Bt=zt.exports,Ht={name:"Index",components:{VTitle:Bt,TabNav:Nt,TopicList:bt,Pager:wt},data:function(){var t=this.$route,e=t.query,a=t.params.tab||"all";return{topics:[],page:Number(e.page)||1,tab:a}},computed:{title:function(){var t="all"===this.tab?"":ut.tabMap[this.tab];return t?t+"板块 - vue-CNode":"vue-CNode"}},mounted:function(){this.fetch()},methods:{fetch:function(){var t=this,e=this.$route,a=e.query,n=e.params.tab||"all",s=Number(a.page)||1,o={tab:n,page:s};this.tab=n,this.page=s,b.getTopics(o).then(function(e){t.topics=e.data.data}).catch(function(e){t.$toasted.error(e)})}},watch:{$route:"fetch"}},Vt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("v-title",[t._v(t._s(t.title))]),t._v(" "),a("div",{staticClass:"panel panel-default"},[a("div",{staticClass:"panel-heading"},[a("tab-nav")],1),t._v(" "),a("div",{staticClass:"panel-body"},[a("TopicList",{attrs:{topics:t.topics}}),t._v(" "),a("Pager",{attrs:{page:t.page,tab:t.tab,name:"Topics"}})],1)])],1)},Qt=[],Jt={render:Vt,staticRenderFns:Qt},Gt=Jt,Yt=a("/Xao"),Zt=r,Kt=Yt(Ht,Gt,!1,Zt,"data-v-4a4d4c39",null),Wt=Kt.exports,te={components:{VTitle:Bt},name:"TopicDetail",data:function(){return{topic:{author:{},replies:[]}}},mounted:function(){this.fetch()},computed:{token:function(){return this.$store.state.accessToken},tabDesc:function(){return ut.tabMap[this.topic.tab]},isCollect:function(){return this.topic.is_collect?"取消收藏":"收藏"}},methods:{fetch:function(){var t=this,e=this.$route.params.id;b.getTopic(e,this.token).then(function(e){console.log("res",e.data),t.topic=e.data.data}).catch(function(e){t.$toasted.error(e)})},checkContent:function(t){return t.replace(/(\/user\/\S+">\S+<\/a>)/g,"#$1")},checkCollect:function(){this.topic.is_collect?this.unCollect():this.collect()},collect:function(){var t=this;b.collect({accesstoken:this.token,topic_id:this.topic.id}).then(function(e){console.log("collect",e),t.topic.is_collect=!0,t.$toasted.success("收藏成功")})},unCollect:function(){var t=this;b.unCollect({accesstoken:this.token,topic_id:this.topic.id}).then(function(e){console.log("unCollect",e),t.topic.is_collect=!1,t.$toasted.success("取消收藏成功")})},agree:function(t){var e=this;if(!this.$store.state.isLogin)return this.$toasted.show("请先登录，登录后即可点赞"),setTimeout(function(){e.$store.commit("showLoginDialog")},3e3);b.upReply(t,this.token).then(function(a){console.log("upReply",a);var n=a.data.action;e.topic.replies.forEach(function(e){e.id===t&&("up"===n?e.ups.push(!0):e.ups.shift())})})}},watch:{token:function(){this.fetch()}}},ee=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container detail"},[a("v-title",[t._v(t._s(t.topic.title))]),t._v(" "),a("div",{staticClass:"panel panel-default"},[a("div",{staticClass:"panel-body"},[a("h3",{staticClass:"title"},[t._v(t._s(t.topic.title))]),t._v(" "),a("div",{staticClass:"meta"},[t._v("\n        发布于 "+t._s(t._f("toLocale")(t.topic.create_at))+" | 作者\n        "),a("router-link",{attrs:{to:{name:"UserIndex",params:{loginname:t.topic.author.loginname}}}},[t._v(t._s(t.topic.author.loginname))]),t._v("\n        | "+t._s(t.topic.visit_count)+"次浏览 | 分类\n        "),a("router-link",{attrs:{to:{name:"Topics",params:{tab:t.topic.tab},query:{page:1}}}},[t._v(t._s(t.tabDesc))]),t._v(" "),t.topic.author_id&&t.token?a("input",{staticClass:"btn-collect btn btn-info pull-right",attrs:{type:"button",value:t.isCollect},on:{click:t.checkCollect}}):t._e()],1),t._v(" "),a("article",{staticClass:"content",domProps:{innerHTML:t._s(t.topic.content)}}),t._v(" "),a("div",{staticClass:"panel panel-default"},[a("div",{staticClass:"panel-heading"},[t._v(t._s(t.topic.replies.length)+" 回复")]),t._v(" "),a("div",{staticClass:"panel-body"},[t.topic.replies.length?a("ul",{staticClass:"list-group"},t._l(t.topic.replies,function(e){return a("li",{staticClass:"list-group-item"},[a("div",[a("router-link",{attrs:{to:{name:"UserIndex",params:{loginname:e.author.loginname}}}},[a("img",{staticClass:"avatar",attrs:{src:e.author.avatar_url}})]),t._v(" "),a("router-link",{attrs:{to:{name:"UserIndex",params:{loginname:e.author.loginname}}}},[a("strong",[t._v(t._s(e.author.loginname))])]),t._v("\n                "+t._s(t._f("toLocale")(e.create_at))+"\n                "),e.author.loginname===t.topic.author.loginname?a("span",{staticClass:"label label-success"},[t._v("作者")]):t._e()],1),t._v(" "),a("div",{staticClass:"reply-content",domProps:{innerHTML:t._s(t.checkContent(e.content))}}),t._v(" "),a("div",{staticClass:"agree",class:{"agree-none":!e.ups.length},on:{click:function(a){t.agree(e.id)}}},[a("span",{staticClass:"glyphicon glyphicon-thumbs-up"}),t._v(t._s(e.ups.length?e.ups.length:"")+"\n              ")])])})):a("span",[t._v("暂无回复")])])])])])],1)},ae=[],ne={render:ee,staticRenderFns:ae},se=ne,oe=a("/Xao"),ie=l,ce=oe(te,se,!1,ie,null,null),re=ce.exports,le={name:"User"},ue=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("router-view")],1)},pe=[],de={render:ue,staticRenderFns:pe},ge=de,ve=a("/Xao"),fe=ve(le,ge,!1,null,null,null),he=fe.exports,me={name:"UserIndex",components:{VTitle:Bt,TopicList:bt},data:function(){return{user:{loginname:"-",recent_topics:[],recent_replies:[],create_at:""},collectTopics:[]}},computed:{githubUrl:function(){return"https://github.com/"+this.user.githubUsername}},mounted:function(){this.fetch()},methods:{fetch:function(){var t=this,e=this.$route.params.loginname;b.getUser(e).then(function(e){t.user=e.data.data}),b.getCollect(e).then(function(e){t.collectTopics=e.data.data}).catch(function(e){t.$toasted.error(e)})}},watch:{$route:"fetch"}},_e=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("v-title",[t._v("@"+t._s(t.user.loginname)+"的个人主页")]),t._v(" "),a("div",{staticClass:"panel panel-default"},[a("div",{staticClass:"panel-heading"},[t._v("用户信息")]),t._v(" "),a("div",{staticClass:"panel-body"},[a("img",{staticClass:"header-img",attrs:{src:t.user.avatar_url}}),t._v(" "),a("div",{staticClass:"user-info-right"},[a("strong",[t._v(t._s(t.user.loginname))]),t._v(" "),a("br"),t._v("\n        github:"),a("a",{staticClass:"dark",attrs:{href:t.githubUrl,target:"_blank"}},[t._v("@"+t._s(t.user.githubUsername))]),a("br"),t._v("\n        "+t._s(t.user.score)+"积分"),a("br"),t._v(" "),a("router-link",{attrs:{to:{name:"Collections"}}},[t._v("收藏的主题 "),t.collectTopics.length?a("span",[t._v("("+t._s(t.collectTopics.length)+")")]):t._e()]),a("br"),t._v("\n        注册时间："+t._s(t._f("toLocale")(t.user.create_at))+"\n      ")],1)])]),t._v(" "),a("div",{staticClass:"panel panel-default"},[a("div",{staticClass:"panel-heading"},[t._v("最近创建的话题")]),t._v(" "),a("div",{staticClass:"panel-body"},[t.user.recent_topics.length?a("TopicList",{attrs:{topics:t.user.recent_topics}}):a("span",[t._v("暂无最近创建的话题")])],1)]),t._v(" "),a("div",{staticClass:"panel panel-default"},[a("div",{staticClass:"panel-heading"},[t._v("最近参与的话题")]),t._v(" "),a("div",{staticClass:"panel-body"},[t.user.recent_replies.length?a("TopicList",{attrs:{topics:t.user.recent_replies}}):a("span",[t._v("暂无最近参与的话题")])],1)])],1)},be=[],Ce={render:_e,staticRenderFns:be},ke=Ce,Te=a("/Xao"),ye=u,$e=Te(me,ke,!1,ye,null,null),Le=$e.exports,xe={name:"Collections",components:{VTitle:Bt,TopicList:bt},data:function(){return{topics:[],loginname:this.$route.params.loginname}},mounted:function(){var t=this;b.getCollect(this.loginname).then(function(e){t.topics=e.data.data}).catch(function(e){t.$toasted.error(e)})}},Ie=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("v-title",[t._v("@"+t._s(t.loginname)+" 的收藏")]),t._v(" "),a("div",{staticClass:"panel panel-default"},[a("div",{staticClass:"panel-heading"},[t._v("\n      "+t._s(t.loginname)+" 的收藏 ("+t._s(t.topics.length)+")\n    ")]),t._v(" "),a("div",{staticClass:"panel-body"},[t.topics.length?a("TopicList",{attrs:{topics:t.topics}}):a("span",[t._v("暂无收藏的主题")])],1)])],1)},we=[],Ue={render:Ie,staticRenderFns:we},De=Ue,Ee=a("/Xao"),Re=p,Se=Ee(xe,De,!1,Re,"data-v-54b4db91",null),Me=Se.exports;d.a.use(lt.a);var Pe=new lt.a({routes:[{path:"/",redirect:{path:"/topics"}},{path:"/topics",redirect:{path:"/topics/all",query:{page:1}}},{path:"/topics/:tab",name:"Topics",component:Wt},{path:"/topic/:id",name:"TopicDetail",component:re},{path:"/user/:loginname",component:he,children:[{path:"",name:"UserIndex",component:Le},{path:"collections",name:"Collections",component:Me}]}]});d.a.config.productionTip=!1,new d.a({el:"#app",router:Pe,template:"<App/>",components:{App:rt}})},PSBo:function(t,e){},QziA:function(t,e){},Uxwe:function(t,e){},gu5E:function(t,e){},zAQO:function(t,e){},zHgc:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.990c12eecbc2f7fed4bf.js.map